<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1" />  
    <title>UCD-CSSA</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="card-list">
        <div class="card-container" v-for="post in posts">
            <div v-if="post.app_msg_ext_info">
                <div class="card-date">{{ formatDate(post.comm_msg_info.datetime * 1000) }}</div>
                <a :href="post.app_msg_ext_info.content_url">
                    <div class="card" v-if="post.app_msg_ext_info.multi_app_msg_item_list.length > 0">
                        <div class="card-post image-hover">
                            <div class="multi-card-title">{{ post.app_msg_ext_info.title }}</div>
                            <div class="linear-background">
                                <img class="card-cover" :src="asLocalImg(post.app_msg_ext_info.cover)" alt="Cover Image">
                            </div>
                        </div>
                        <div v-for="sub_post in post.app_msg_ext_info.multi_app_msg_item_list" :key="sub_post.title">
                            <a class="card-sub-item background-hover" :href="sub_post.content_url">
                                <div class="card-sub-title">{{ sub_post.title }}</div>
                                <img class="card-sub-cover" :src="asLocalImg(sub_post.cover)" alt="Sub Cover Image">
                            </a>
                        </div>
                    </div>
                    <div class="card image-hover" v-else>
                        <img class="card-cover" :src="asLocalImg(post.app_msg_ext_info.cover)" alt="Cover Image">
                        <div class="card-content">
                            <div class="card-title">{{ post.app_msg_ext_info.title }}</div>
                            <p class="card-description">{{ post.app_msg_ext_info.digest }}</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@latest/dist/vue.global.js"></script>
    <script>
        const app = Vue.createApp({
            data() {
                return {
                    posts: []
                };
            },
            async created() {
                this.posts = await (await fetch("data/posts.json")).json();
            },
            methods: {
                formatDate(timestamp) {
                    const date = new Date(timestamp);
                    const now = new Date();
                    const yesterday = new Date(now - 24 * 60 * 60 * 1000);
                    const lastWeek = new Date(now - 6 * 24 * 60 * 60 * 1000);
                    if (date.toDateString() === now.toDateString()) {
                        return '今天';
                    } else if (date.toDateString() === yesterday.toDateString()) {
                        return '昨天';
                    } else if (date > lastWeek) {
                        return '星期' + ['日', '一', '二', '三', '四', '五', '六'][date.getDay()];
                    } else {
                        return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
                    }
                },
                asLocalImg(url) {
                    return `imgs/${url.split('/')[4]}.jpg`;
                }
            }
        });
        app.mount('.card-list');
    </script>
</body>
</html>
